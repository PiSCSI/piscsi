.Dd October 30, 2023
.Dt SCSIDUMP 1
.Os PiSCSI
.Sh NAME
.Nm scsidump
.Nd SCSI disk dumping tool for PiSCSI
.Sh SYNOPSIS
.Nm
.Op Fl I Ar ID Ns Oo : Ar LUN Oc
.Op Fl i Ar BID
.Fl f Ar FILE
.Op Fl p
.Op Fl s Ar BUFFER_SIZE
.Op Fl r
.Op Fl S
.Fl t Ar ID Ns Oo : Ar LUN Oc
.Op Fl v
.Sh DESCRIPTION
.Nm
has two modes of operation: dump and restore. These can be used with physical storage media, including hard drives and magneto optical drives. Dump mode can be used with read-only media such as CD/DVD drives.
.Pp
When operating in dump mode, scsidump will copy all data from a remote SCSI drive to an image on the local filesystem. If enabled, it will also generate a .properties file that can be used to more closely emulate the source drive.
.Pp
If you are operating in restore mode, scsidump will copy the data from a local binary image to a remote physical SCSI drive. The remote SCSI drive MUST be writable.
.Sh NOTES
.Nm
requires either a direct connection (one without transceivers) or a FULLSPEC PiSCSI/RaSCSI board.
.Pp
If the generated drive image is intended to be used with PiSCSI, the drive image should be moved by the user to ~/images (or the location specified to the piscsi service).
.Sh OPTIONS
.Bl -tag -width Ds
.It Fl I Ar ID Ns Oo : Ar LUN Oc
Display INQUIRY data of ID[:LUN].
.It Fl i Ar BID
SCSI ID of the PiSCSI device. If not specified, the PiSCSI device will use ID 7. The PiSCSI host will be functioning as the "Initiator" device.
.It Fl o Ar offs
Use `offs` as the sector offset to start dumping. It must be aligned to the buffer size. Can be used to resume an aborted transfer from/to a somewhat broken device by specifying the last shown sector number.
.It Fl f Ar FILE
Path to the dump file.
.It Fl p
Generate a .properties file that is compatible with the PiSCSI web interface. The output filename will match the image filename with ".properties" appended. The generated file should be moved to ~/.config/piscsi.
.It Fl r
Run in restore mode. Defaults to dump mode if not specified.
.It Fl S
Scan SCSI bus for devices.
.It Fl s Ar BUFFER_SIZE
The transfer buffer size, specified in bytes. Default is 1 MiB. This is specified in bytes with a minimum value of 65536 (64 KiB).
.It Fl t Ar ID Ns Oo : Ar LUN Oc
SCSI ID and optional LUN of the remote SCSI device. The remote SCSI device will be functioning as the "Target" device.
.It Fl v
Enable verbose logging.
.El
.Sh EXAMPLES
Dump Mode: [SCSI Drive] ---> [PiSCSI host]
.Pp
Launch scsidump to dump an all data from SCSI ID 3 with block size 64 KiB, store it to the local filesystem as a drive image named outimage.hda, and generate the outimage.hda.properties file with the drive's INQUIRY information:
.Dl Nm scsidump -t 3 -f ./outimage.hda -s 65536 -p
.Pp
Restore Mode: [PiSCSI host] ---> [SCSI Drive]
.Pp
Launch scsidump to restore/upload a drive image from the local file system to SCSI ID 0 with block size 1MiB:
.Dl Nm scsidump -r -t 0 -f ./outimage.hda -s 1048576
.Sh SEE ALSO
.Xr scsictl 1 ,
.Xr piscsi 1 ,
.Xr scsimon 1
.Pp
Full documentation is available at: <https://www.piscsi.com>
